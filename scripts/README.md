# OpenVPN Client Management Scripts

–ù–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏ OpenVPN —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

## üìÅ –§–∞–π–ª—ã

- `add.sh` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ OpenVPN
- `remove.sh` - –£–¥–∞–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ OpenVPN
- `openvpn-install.sh` - –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ OpenVPN —Å–µ—Ä–≤–µ—Ä–∞

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Linux —Å–∏—Å—Ç–µ–º–∞ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º OpenVPN —Å–µ—Ä–≤–µ—Ä–æ–º
- –ü—Ä–∞–≤–∞ root (sudo) –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π easy-rsa –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏

## üìã –°–∫—Ä–∏–ø—Ç add.sh

### –û–ø–∏—Å–∞–Ω–∏–µ
–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ OpenVPN —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å
```bash
sudo ./add.sh <client_name> [output_directory] [password_protected]
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
- `client_name` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è, –¥–µ—Ñ–∏—Å—ã)
- `output_directory` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø–∞–ø–∫–∞ —Å–æ —Å–∫—Ä–∏–ø—Ç–æ–º)
- `password_protected` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –°—Ç—Ä–æ–∫–∞ "password" –¥–ª—è –∑–∞—â–∏—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ –ø–∞—Ä–æ–ª–µ–º

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```bash
# –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –±–µ–∑ –ø–∞—Ä–æ–ª—è –≤ –ø–∞–ø–∫–µ —Å–æ —Å–∫—Ä–∏–ø—Ç–æ–º
CONFIG_PATH=$(sudo ./add.sh myclient)
echo "Config saved to: $CONFIG_PATH"

# –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
CONFIG_PATH=$(sudo ./add.sh myclient /tmp/vpn-configs)

# –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–∞—Ä–æ–ª–µ–º –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
CONFIG_PATH=$(sudo ./add.sh myclient /tmp/vpn-configs password)
```

### –ö–æ–¥—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
- `0` - –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- `1` - –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –í—ã–≤–æ–¥
- **–£—Å–ø–µ—Ö**: –ü—É—Ç—å –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É
- **–û—à–∏–±–∫–∞**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤ stderr

### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏
- `‚ùå This script must be run as root (use sudo)` - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
- `‚ùå OpenVPN server is not installed!` - OpenVPN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- `‚ùå Invalid client name` - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞
- `‚ùå Client 'name' already exists!` - –ö–ª–∏–µ–Ω—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `‚ùå Cannot create output directory` - –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- `‚ùå Output directory is not writable` - –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- `‚ùå Cannot access /etc/openvpn/easy-rsa/` - –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ easy-rsa

## üóëÔ∏è –°–∫—Ä–∏–ø—Ç remove.sh

### –û–ø–∏—Å–∞–Ω–∏–µ
–£–¥–∞–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ OpenVPN, –æ—Ç–∑—ã–≤–∞–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ —É–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å
```bash
sudo ./remove.sh <client_name> [config_file_path]
sudo ./remove.sh --list
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
- `client_name` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
- `config_file_path` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
- `--list` –∏–ª–∏ `-l` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```bash
# –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ (–ø–æ–∏—Å–∫ –∫–æ–Ω—Ñ–∏–≥–∞ –≤ –ø–∞–ø–∫–µ —Å–æ —Å–∫—Ä–∏–ø—Ç–æ–º)
if sudo ./remove.sh myclient; then
    echo "Client removed successfully"
else
    echo "Failed to remove client"
fi

# –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—É—Ç–∏ –∫ –∫–æ–Ω—Ñ–∏–≥—É
sudo ./remove.sh myclient /path/to/myclient.ovpn

# –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
sudo ./remove.sh --list
```

### –ö–æ–¥—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
- `0` - –£—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- `1` - –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –í—ã–≤–æ–¥
- **–£—Å–ø–µ—Ö**: –ù–∏–∫–∞–∫–æ–≥–æ –≤—ã–≤–æ–¥–∞ (—Ç–æ–ª—å–∫–æ –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ 0)
- **–û—à–∏–±–∫–∞**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤ stderr

### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏
- `‚ùå This script must be run as root (use sudo)` - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
- `‚ùå OpenVPN server is not installed!` - OpenVPN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- `‚ùå Client 'name' not found!` - –ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
- `‚ùå Cannot access /etc/openvpn/easy-rsa/` - –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ easy-rsa

## üîÑ –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `add.sh` —Å –∏–º–µ–Ω–µ–º –∫–ª–∏–µ–Ω—Ç–∞ –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π/–ø–∞—Ä–æ–ª–µ–º
2. –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –∫–æ–Ω—Ñ–∏–≥ —Ñ–∞–π–ª
3. –ü–æ–ª—É—á–∏—Ç–µ –ø—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É –∏–∑ –≤—ã–≤–æ–¥–∞ —Å–∫—Ä–∏–ø—Ç–∞
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞

### –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `remove.sh` —Å –∏–º–µ–Ω–µ–º –∫–ª–∏–µ–Ω—Ç–∞
2. –°–∫—Ä–∏–ø—Ç –æ—Ç–∑–æ–≤–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ —É–¥–∞–ª–∏—Ç –∫–æ–Ω—Ñ–∏–≥
3. –ö–ª–∏–µ–Ω—Ç –±–æ–ª—å—à–µ –Ω–µ —Å–º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

### –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
```bash
#!/bin/bash

# –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
echo "Creating client..."
CONFIG_PATH=$(sudo ./add.sh testclient /tmp/vpn-configs password)
if [[ $? -eq 0 ]]; then
    echo "‚úÖ Client created: $CONFIG_PATH"
else
    echo "‚ùå Failed to create client"
    exit 1
fi

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞...

# –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
echo "Removing client..."
if sudo ./remove.sh testclient "$CONFIG_PATH"; then
    echo "‚úÖ Client removed successfully"
else
    echo "‚ùå Failed to remove client"
    exit 1
fi
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
/opt/vpn-scripts/
‚îú‚îÄ‚îÄ add.sh                 # –°–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ remove.sh              # –°–∫—Ä–∏–ø—Ç —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ openvpn-install.sh     # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îî‚îÄ‚îÄ client1.ovpn          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
    client2.ovpn
    ...
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã —Å –ø—Ä–∞–≤–∞–º–∏ root
2. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏**: –°–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞—é—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –≤–∞–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
3. **–ù–µ–æ–±—Ä–∞—Ç–∏–º–æ—Å—Ç—å**: –û—Ç–∑—ã–≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –Ω–µ–æ–±—Ä–∞—Ç–∏–º
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°–∫—Ä–∏–ø—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ OpenVPN

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ OpenVPN
```bash
ls -la /etc/openvpn/server.conf
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ easy-rsa
```bash
ls -la /etc/openvpn/easy-rsa/
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
journalctl -u openvpn@server -f
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```bash
ls -la /etc/openvpn/easy-rsa/pki/issued/
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (–∑–∞–ø—É—Å–∫ —Å sudo)
2. –£—Å—Ç–∞–Ω–æ–≤–∫—É OpenVPN —Å–µ—Ä–≤–µ—Ä–∞
3. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å easy-rsa
4. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏